import{r as e,o as a,c as o,a as n,F as r,d as t,b as s}from"./app.ea66aa66.js";const i={},l=t('<h2 id="methodswizzle-safeobject-keyboard-cfautoreleasepoolpop-crash" tabindex="-1"><a class="header-anchor" href="#methodswizzle-safeobject-keyboard-cfautoreleasepoolpop-crash" aria-hidden="true">#</a> MethodSwizzle-SafeObject-Keyboard-CFAutoreleasePoolPop-Crash</h2><p>解决使用了method swizzle将NSArray和NSMutableArray的objectAtIndex:等其他类进行数据安全导致的CFAutoreleasePoolPop的崩溃问题，以及一些奇怪的问题。</p><h3 id="测试" tabindex="-1"><a class="header-anchor" href="#测试" aria-hidden="true">#</a> 测试</h3><pre><code>1.问题 ：  \n    Xcode崩溃代码：\n    [UIKeyboardLayoutStar release]: message sent to deallocated instance 0x101055800\n\n    崩溃日志:\n     Crashed: com.apple.main-thread\n    0  libobjc.A.dylib                0x187b917f4 objc_object::release() + 8\n    1  libsystem_blocks.dylib         0x18801fa68 _Block_release + 160\n    2  UIKit                          0x18fcd19f4 -[UIKeyboardTaskEntry dealloc] + 68\n    3  libobjc.A.dylib                0x187b92134 (anonymous namespace)::AutoreleasePoolPage::pop(void*) + 836\n    4  CoreFoundation                 0x188feeb28 _CFAutoreleasePoolPop + 28\n    5  UIKit                          0x18f4c33e8 _prepareForCAFlush + 596\n    6  UIKit                          0x18f2372f4 _afterCACommitHandler + 236\n    7  CoreFoundation                 0x1890c09a8 __CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__ + 32\n    8  CoreFoundation                 0x1890be630 __CFRunLoopDoObservers + 372\n    9  CoreFoundation                 0x1890bea7c __CFRunLoopRun + 956\n    10 CoreFoundation                 0x188feeda4 CFRunLoopRunSpecific + 424\n    11 GraphicsServices               0x18aa59074 GSEventRunModal + 100\n    12 UIKit                          0x18f2a9c9c UIApplicationMain + 208\n    13 SydneyToday                    0x100116550 main (main.m:14)\n    14 libdyld.dylib                  0x187ffd59c start + 4\n\n2.测试环境：\n    * iOS 10.3.3 (iOS11以下都测出问题，包括iOS8,iOS9)\n    * 项目中拖入Safe文件夹内的文件（文件使用MethodSwizzle 实现对数组、字典 等系统方法的安全校验）\n    * 开启Xcode的Zombie Objects\n\n3.如何复现：\n    找到能弹出键盘的界面中，键盘显示的情况下  home app 进入后台，再单击app  图标 切换回前台时 发生crash\n\n4. 处理\n    Safe文件设置为挂钩NSMutableArray方法编译器标志的位置 -fno-objc-arc\n</code></pre><h3 id="发现" tabindex="-1"><a class="header-anchor" href="#发现" aria-hidden="true">#</a> 发现</h3><p>除了能导致CFAutoreleasePoolPop崩溃问题，我们发散思维想：是否也会影响键盘弹出时输入法。</p><p>前因： 为何会想到它能影响键盘输入法? 解释： 当然是遇到坑，而且是大坑，发现了几个月，但一直没找到解决办法 什么坑： 个别用户手机（我们遇到的基本是iphoneX）使用我们App点击任何输入框，弹出的键盘无法输入中文，也无法切换中文，切换的小地球不见，而是一个表情按钮。但其他App正常。一开始收到这个bug，无从下手，基本想不到自己项目中哪里的问题，因为键盘是系统的，非第三方，我们代码是没办法控制系统键盘。几经周折，最后不了了之。</p>',7),d=n("p",null,"这次处理CFAutoreleasePoolPop这个崩溃问题，给问题机测试，键盘切换中文正常，欧耶！！终于处理了一个疑难杂症，一箭双雕！",-1),c={href:"https://github.com/Qson8/MethodSwizzle-SafeObject-Keyboard-CFAutoreleasePoolPop-Crash",target:"_blank",rel:"noopener noreferrer"},p=s("Demo地址");i.render=function(t,s){const i=e("OutboundLink");return a(),o(r,null,[l,n("img",{src:t.$withBase("/ios/bugs/1.png"),alt:"https://img01.jituwang.com/171030/256786-1G030214S965.jpg"},null,8,["src"]),n("img",{src:t.$withBase("/ios/bugs/2.gif"),alt:"https://img01.jituwang.com/171030/256786-1G030214S965.jpg"},null,8,["src"]),d,n("p",null,[n("a",c,[p,n(i)])])],64)};export default i;
